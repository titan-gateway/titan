# HAProxy Configuration for Benchmark
# High-performance TCP/HTTP load balancer

global
    maxconn 4096
    nbthread 4  # Match thread-per-core
    cpu-map auto:1-4 0-3
    log /dev/log local0
    daemon

defaults
    mode http
    log global
    option httplog
    option dontlognull
    option http-server-close
    option http-keep-alive
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    maxconn 3000

# Frontend (HTTP/1.1)
frontend http-in
    bind :8080
    default_backend backend-servers

# Frontend (HTTP/2 over TLS)
frontend https-in
    bind :8443 ssl crt /workspace/certs/server.pem alpn h2,http/1.1
    default_backend backend-servers

# Backend
backend backend-servers
    balance roundrobin
    option http-keep-alive
    http-reuse always
    server backend1 127.0.0.1:3001 maxconn 1000
